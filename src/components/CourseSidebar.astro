---
import BaseSidebar from "./BaseSidebar.astro";
import type { CourseSection } from "../lib/courses";

interface Props {
  sections: CourseSection[];
  currentSlug?: string;
  courseTitle?: string;
}

const { sections, currentSlug, courseTitle } = Astro.props;
---

<BaseSidebar collapsible id="course-sidebar">
  <div class="sidebar-content">
    {courseTitle && (
      <h2 class="course-title">{courseTitle}</h2>
    )}
    {
      sections.map((section) => (
        <div class="section">
          {section.title && (
            <h3 class="section-title">
              {section.title}
            </h3>
          )}
          <ul class="lesson-list">
            {section.lessons.map((lesson) => {
              const isActive = lesson.id === currentSlug;
              const href = `/courses/${lesson.id}`;
              const isDisabled = lesson.data.comingSoon;

              return (
                <li
                  class:list={[
                    "lesson",
                    { active: isActive, disabled: isDisabled },
                  ]}
                >
                  {isDisabled ? (
                    <span class="lesson-link disabled">
                      {lesson.data.title}
                    </span>
                  ) : (
                    <a
                      href={href}
                      class:list={["lesson-link", { active: isActive }]}
                    >
                      {lesson.data.title}
                    </a>
                  )}
                </li>
              );
            })}
          </ul>
        </div>
      ))
    }
  </div>
</BaseSidebar>

<style>
  .sidebar-content {
    padding: var(--space-md) 0;
  }

  .course-title {
    font-size: 1rem;
    font-weight: 600;
    color: var(--text);
    padding: 0 var(--space-lg);
    margin-bottom: var(--space-lg);
    padding-bottom: var(--space-md);
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
  }

  .section {
    margin-bottom: var(--space-lg);
  }

  .section-title {
    font-size: 0.8125rem;
    font-weight: 500;
    color: rgba(255, 255, 255, 0.45);
    margin-bottom: var(--space-sm);
    padding: 0 var(--space-lg);
  }

  .lesson-list {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .lesson {
    padding: 2px var(--space-lg);
  }

  .lesson-link {
    font-size: 0.875rem;
    color: var(--text);
    text-decoration: none;
    line-height: 1.15;
    display: block;
  }

  .lesson-link:hover {
    color: #fb923c;
  }

  .lesson-link.active {
    color: #f97316;
  }

  .lesson-link.disabled {
    color: rgba(136, 136, 136, 0.4);
    cursor: not-allowed;
  }
</style>
