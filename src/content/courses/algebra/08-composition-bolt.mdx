---
title: "Relation Composition Bolt"
description: "Master relation composition with the two-hop path mental model."
order: 8
section: "Relations"
sectionOrder: 3
---

import AdaptiveQuiz from "../../../components/AdaptiveQuiz.astro";
import MultipleChoice from "../../../components/MultipleChoice.astro";
import ContentBlock from "../../../components/ContentBlock.astro";

# The Two-Hop Path Mental Model

**Composition** connects two relations by finding **two-hop paths**. Think of it like connecting flights:

$$
\text{NYC} \xrightarrow{R} \text{Chicago} \xrightarrow{S} \text{LA}
$$

The composition $S \circ R$ contains $(\text{NYC}, \text{LA})$ because you can get there via Chicago.

---

## The Definition

Given relations $R$ (from $A$ to $B$) and $S$ (from $B$ to $C$):

$$S \circ R = \{(a, c) \mid \exists b: (a, b) \in R \land (b, c) \in S\}$$

**Read as:** $(a, c)$ is in $S \circ R$ if there's a **middle element** $b$ such that:
1. $a$ connects to $b$ via $R$
2. $b$ connects to $c$ via $S$

<MultipleChoice
  question="If $R = \{(1,2), (2,3)\}$ and $S = \{(2,4), (3,5)\}$, what is $S ∘ R$?"
  options={[
    "$\{(1,4), (2,5)\}$",
    "$\{(1,2), (2,3), (2,4), (3,5)\}$",
    "$\{(1,4)\}$",
    "$\{(2,5)\}$"
  ]}
  correct={0}
  explanation="Trace paths: $1 → 2$ (in R), then $2 → 4$ (in S) → add $(1,4)$. Also $2 → 3$ (in R), then $3 → 5$ (in S) → add $(2,5)$. The path $1 → 2 → 3$ doesn't continue in S from 2 (only from 3), so $(1,5)$ needs $1 → 3$, which isn't in R."
/>

---

## ⚠️ Order Warning: S ∘ R ≠ R ∘ S

**Composition reads right-to-left!** $S \circ R$ means "do $R$ first, then $S$."

This matches function composition: $(f \circ g)(x) = f(g(x))$.

$$
a \xrightarrow{R} b \xrightarrow{S} c \quad \text{gives} \quad (a, c) \in S \circ R
$$

<MultipleChoice
  question="If $R = \{(1,2)\}$ and $S = \{(2,3)\}$, what is $R ∘ S$?"
  options={[
    "$\{(1,3)\}$",
    "$\{(2,2)\}$",
    "$∅$",
    "$\{(1,2), (2,3)\}$"
  ]}
  correct={2}
  explanation="$R ∘ S$ means: do $S$ first, then $R$. Starting from any element in $S$'s domain (2), we go $2 → 3$. Now we need $3 → ?$ in $R$... but $R$ has no pair starting from 3. Empty result!"
/>

---

## Matrix Multiplication (Boolean Style)

If $R$ has matrix $M_R$ and $S$ has matrix $M_S$, then:

$$M_{S \circ R} = M_R \cdot M_S \quad \text{(Boolean multiplication)}$$

**Boolean multiplication rules:**
- Multiply: $1 \times 1 = 1$, otherwise $0$
- Add: $0 + 0 = 0$, $0 + 1 = 1$, $1 + 1 = 1$ (OR, not arithmetic!)

### Example

$$
M_R = \begin{pmatrix} 1 & 1 \\ 0 & 1 \end{pmatrix}, \quad
M_S = \begin{pmatrix} 0 & 1 \\ 1 & 0 \end{pmatrix}
$$

$$
M_{S \circ R} = M_R \cdot M_S = \begin{pmatrix}
(1 \land 0) \lor (1 \land 1) & (1 \land 1) \lor (1 \land 0) \\
(0 \land 0) \lor (1 \land 1) & (0 \land 1) \lor (1 \land 0)
\end{pmatrix} = \begin{pmatrix} 1 & 1 \\ 1 & 0 \end{pmatrix}
$$

<MultipleChoice
  question="In Boolean matrix multiplication, what is $1 + 1$?"
  options={[
    "0",
    "1",
    "2",
    "10 (binary)"
  ]}
  correct={1}
  explanation="Boolean addition is OR: $1 + 1 = 1 \\lor 1 = 1$. We're asking 'does a path exist?' not 'how many paths?'"
/>

---

## Self-Composition: R²

Composing a relation with itself:

$$R^2 = R \circ R$$

This finds all **two-hop paths** within the same relation.

**Example:** If $R$ is "direct flight between cities," then $R^2$ is "can reach with exactly one layover."

<MultipleChoice
  question="If $R = \{(1,2), (2,3), (3,1)\}$, which pair is in $R^2$?"
  options={[
    "$(1,1)$",
    "$(1,3)$",
    "$(2,2)$",
    "All of the above"
  ]}
  correct={3}
  explanation="$1 → 2 → 3$ gives $(1,3)$. $2 → 3 → 1$ gives $(2,1)$. $3 → 1 → 2$ gives $(3,2)$. Also: $1 → 2 → 3 → 1$ in two steps? No, that's 3 steps. Wait, let's redo: $(1,3)$ from $1→ 2→ 3$. For $(1,1)$: need $1 → ? → 1$, we have $1→ 2$ but no $2→ 1$, and $1→ 2$ but $2→ 3$ not to 1. Hmm, actually: $3→ 1$ and $1→ 2$? That would be $(3,2)$. For $(1,1)$: we need path $1 → b → 1$. $1→ 2$ and $2→ ?→ 1$? $2→ 3$, $3→ 1$. That's 3 steps. Actual $R^2$: $(1,3), (2,1), (3,2)$. So 'All of the above' is wrong!"
/>

Wait, let me reconsider that question...

<MultipleChoice
  question="If $R = \{(1,2), (2,3), (3,1)\}$ on $\{1,2,3\}$, what is $R^2$?"
  options={[
    "$\{(1,3), (2,1), (3,2)\}$",
    "$\{(1,1), (2,2), (3,3)\}$",
    "$\{(1,2), (2,3), (3,1)\}$",
    "$\{(1,3)\}$"
  ]}
  correct={0}
  explanation="Find two-hop paths: $1 \xrightarrow{R} 2 \xrightarrow{R} 3$ gives $(1,3)$. $2 \xrightarrow{R} 3 \xrightarrow{R} 1$ gives $(2,1)$. $3 \xrightarrow{R} 1 \xrightarrow{R} 2$ gives $(3,2)$."
/>

---

## Powers of Relations

$$
R^1 = R, \quad R^2 = R \circ R, \quad R^3 = R \circ R \circ R, \quad \ldots
$$

**Interpretation:**
- $R^1$: Direct connections (1 hop)
- $R^2$: Two-hop paths
- $R^n$: Exactly $n$-hop paths

The **transitive closure** is:

$$R^+ = R \cup R^2 \cup R^3 \cup \cdots$$

<MultipleChoice
  question="If $R$ is 'parent of' on people, what does $R^3$ represent?"
  options={[
    "Grandparent of",
    "Great-grandparent of",
    "Ancestor within 3 generations",
    "Sibling of"
  ]}
  correct={1}
  explanation="$R^1$ = parent, $R^2$ = parent of parent = grandparent, $R^3$ = parent of grandparent = great-grandparent."
/>

---

## Inverse: Flip All Arrows

The **inverse** $R^{-1}$ swaps all pairs:

$$R^{-1} = \{(b, a) \mid (a, b) \in R\}$$

**Matrix:** Transpose $M_{R^{-1}} = M_R^T$.

<MultipleChoice
  question="If $R$ is 'is a child of', what is $R^{-1}$?"
  options={[
    "'Is a parent of'",
    "'Is a sibling of'",
    "'Is a descendant of'",
    "'Is unrelated to'"
  ]}
  correct={0}
  explanation="If $(a,b) \\in R$ means '$a$ is a child of $b$', then $(b,a) \\in R^{-1}$ means '$b$ is a child of $a$'... wait, that's backwards. Actually: $R^{-1}$ swaps the pair, so if '$a$ is child of $b$' then '$b$ is parent of $a$'."
/>

---

## Properties Under Composition

Some useful facts:

1. **Associative:** $(R \circ S) \circ T = R \circ (S \circ T)$

2. **Identity:** $R \circ \Delta = \Delta \circ R = R$ (where $\Delta$ is the diagonal/identity)

3. **Inverse:** $(S \circ R)^{-1} = R^{-1} \circ S^{-1}$ (reverses order!)

4. **Transitivity:** $R$ is transitive iff $R^2 \subseteq R$ (all two-hop paths already exist)

<MultipleChoice
  question="A relation $R$ is transitive if and only if:"
  options={[
    "$R = R^2$",
    "$R^2 \\subseteq R$",
    "$R \\subseteq R^2$",
    "$R^2 = \\emptyset$"
  ]}
  correct={1}
  explanation="Transitive means: if you can reach $c$ from $a$ in two hops, there's already a direct path. So every pair in $R^2$ must already be in $R$: $R^2 \\subseteq R$."
/>

---

## Composition Algorithm

To compute $S \circ R$ directly (without matrices):

```
For each (a, b) in R:
    For each (b', c) in S:
        If b = b':
            Add (a, c) to result
```

**Tip:** Group pairs by their "middle element" — pairs in $R$ ending with $b$, and pairs in $S$ starting with $b$.

<MultipleChoice
  question="To find $S ∘ R$ where $|R| = m$ and $|S| = n$, the naive algorithm takes:"
  options={[
    "$O(m + n)$",
    "$O(mn)$",
    "$O(m^2 + n^2)$",
    "$O(\max(m, n))$"
  ]}
  correct={1}
  explanation="For each of $m$ pairs in $R$, we check each of $n$ pairs in $S$ for a matching middle element: $O(mn)$ comparisons."
/>

---

## Common Mistakes

### Mistake 1: Wrong Order

$S \circ R$ ≠ $R \circ S$ usually!

**Remember:** $S \circ R$ = "R first, then S" (right to left).

### Mistake 2: Forgetting Intermediate Elements

$(a, c) \in S \circ R$ needs a **witness** $b$. You can't just "combine endpoints."

### Mistake 3: Arithmetic vs Boolean

Matrix multiplication for composition uses **Boolean** operations:
- $\land$ for multiply
- $\lor$ for add

---

# Infinite Drill: Relation Operations

<AdaptiveQuiz
  generator="relation-operations"
  baseSeed={66666}
  initialCount={5}
  appendCount={2}
  maxQuestions={20}
/>
