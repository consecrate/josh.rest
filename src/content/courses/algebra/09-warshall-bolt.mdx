---
title: "Warshall's Algorithm Bolt"
description: "Master Warshall's Algorithm with step-by-step worked examples and the reachability mental model."
order: 9
section: "Bolts"
sectionOrder: 2
---

import AdaptiveQuiz from "../../../components/AdaptiveQuiz.astro";
import MultipleChoice from "../../../components/MultipleChoice.astro";
import ContentBlock from "../../../components/ContentBlock.astro";

# The Reachability Mental Model

**Warshall's algorithm** answers a fundamental question: *"Can I get from node A to node B?"*

Think of it like a GPS finding all possible routes in a city. Instead of finding one path, Warshall's algorithm finds **all reachable destinations** from every starting point.

$$
\text{Direct path?} \quad \text{OR} \quad \text{Path through an intermediate stop?}
$$

The beauty: it does this in **O(n³)** time, where $n$ is the number of nodes—fast enough for practical use!

---

## What Problem Does Warshall Solve?

Given a directed graph (or relation), we want to find its **transitive closure**:

> $(a, c)$ is in the transitive closure if there exists **any path** from $a$ to $c$, regardless of length.

**Example:** If there's a flight from NYC → Chicago and a flight from Chicago → LA, then the transitive closure should include NYC → LA (reachable via connection).

<MultipleChoice
  question="If relation $R$ has edges $1 \to 2$, $2 \to 3$, and $3 \to 4$, which pair should be in the transitive closure?"
  options={[
    "$(1, 4)$ only",
    "$(1, 3)$ and $(2, 4)$ only",
    "$(1, 3)$, $(1, 4)$, and $(2, 4)$",
    "No additional pairs needed"
  ]}
  correct={2}
  explanation="The transitive closure includes ALL reachable pairs: $1 \to 2 \to 3$ gives $(1,3)$, $1 \to 2 \to 3 \to 4$ gives $(1,4)$, and $2 \to 3 \to 4$ gives $(2,4)$."
/>

---

## The Core Idea: Build Paths Incrementally

Warshall's genius is building up reachability **one intermediate node at a time**:

| Matrix | Meaning |
|--------|---------|
| $W_0$ | Original edges (direct connections only) |
| $W_1$ | Paths allowed through node 1 |
| $W_2$ | Paths allowed through nodes 1 and 2 |
| ... | ... |
| $W_n$ | Paths allowed through any node = **transitive closure** |

At each step $k$, we ask: *"Can we create a new path by routing through node $k$?"*

---

## The Magic Formula

$$W_k[i][j] = W_{k-1}[i][j] \;\lor\; (W_{k-1}[i][k] \land W_{k-1}[k][j])$$

**Translation in English:**

> "Can I reach $j$ from $i$, using only nodes 1 through $k$ as intermediates?"
> 
> **YES** if either:
> 1. I could already reach $j$ from $i$ without using node $k$, **OR**
> 2. I can reach node $k$ from $i$ **AND** reach $j$ from node $k$

<MultipleChoice
  question="In step $k$ of Warshall's algorithm, when do we set $W_k[i][j] = 1$?"
  options={[
    "Only if there's a direct edge from $i$ to $j$",
    "If $W_{k-1}[i][j] = 1$ OR both $W_{k-1}[i][k] = 1$ and $W_{k-1}[k][j] = 1$",
    "If $W_{k-1}[i][k] = 1$ and $W_{k-1}[j][k] = 1$",
    "Only if $i = k$ or $j = k$"
  ]}
  correct={1}
  explanation="The formula checks: already reachable (preserve existing 1s) OR can route through $k$ (need path to $k$ AND path from $k$)."
/>

---

# Worked Example 1: The Classic Chain

Let's trace Warshall's algorithm on a simple chain: $1 \to 2 \to 3$

**Initial matrix $W_0$:**

$$
W_0 = \begin{pmatrix}
0 & 1 & 0 \\
0 & 0 & 1 \\
0 & 0 & 0
\end{pmatrix}
$$

This represents: edge $(1,2)$ and edge $(2,3)$.

---

## Step 1: Process Node 1 ($k = 1$)

**Question:** Can routing through node 1 create any new paths?

For each cell $W[i][j]$, check if $W[i][1] = 1$ AND $W[1][j] = 1$.

Looking at column 1 and row 1 of $W_0$:
- Column 1 (who can reach node 1?): Nobody — all zeros
- Row 1 (who can node 1 reach?): Node 2

Since **nobody can reach node 1** (column 1 is all zeros), routing through node 1 creates **no new paths**.

$$
W_1 = \begin{pmatrix}
0 & 1 & 0 \\
0 & 0 & 1 \\
0 & 0 & 0
\end{pmatrix}
$$

No changes! ✓

---

## Step 2: Process Node 2 ($k = 2$)

**Question:** Can routing through node 2 create any new paths?

Check column 2 and row 2:
- Column 2 (who can reach node 2?): Node 1 can! $W[1][2] = 1$
- Row 2 (who can node 2 reach?): Node 3! $W[2][3] = 1$

**Critical insight:** Node 1 can reach node 2, and node 2 can reach node 3.

Therefore: $W[1][3] = W[1][2] \land W[2][3] = 1 \land 1 = 1$

**We found a new path: $1 \to 3$!**

$$
W_2 = \begin{pmatrix}
0 & 1 & \mathbf{1} \\
0 & 0 & 1 \\
0 & 0 & 0
\end{pmatrix}
$$

---

## Step 3: Process Node 3 ($k = 3$)

**Question:** Can routing through node 3 create any new paths?

Check column 3 and row 3:
- Column 3 (who can reach node 3?): Nodes 1 and 2
- Row 3 (who can node 3 reach?): Nobody — row 3 is all zeros

Since **node 3 can't reach anyone** (row 3 is all zeros), routing through node 3 creates **no new paths**.

$$
W_3 = \begin{pmatrix}
0 & 1 & 1 \\
0 & 0 & 1 \\
0 & 0 & 0
\end{pmatrix}
$$

**Final transitive closure!** The relation now includes $(1,3)$ — we can reach 3 from 1.

<MultipleChoice
  question="In the chain $1 \to 2 \to 3$ example, at which step did we discover the path from 1 to 3?"
  options={[
    "Step 1 (processing node 1)",
    "Step 2 (processing node 2)",
    "Step 3 (processing node 3)",
    "It was already in $W_0$"
  ]}
  correct={1}
  explanation="At step 2, we checked: can we go $1 \to 2 \to 3$? Yes! Node 2 is the intermediate that connects 1 to 3."
/>

---

# Worked Example 2: A Triangle with Missing Edge

Consider relation $R = \{(1,2), (2,3), (3,1)\}$ — a cycle!

$$
W_0 = \begin{pmatrix}
0 & 1 & 0 \\
0 & 0 & 1 \\
1 & 0 & 0
\end{pmatrix}
$$

**Goal:** Find all reachable pairs in this cycle.

---

## Step 1: Process Node 1 ($k = 1$)

- Column 1: Node 3 can reach node 1 ($W[3][1] = 1$)
- Row 1: Node 1 can reach node 2 ($W[1][2] = 1$)

**New path:** $3 \to 1 \to 2$, so $W[3][2] = 1$!

$$
W_1 = \begin{pmatrix}
0 & 1 & 0 \\
0 & 0 & 1 \\
1 & \mathbf{1} & 0
\end{pmatrix}
$$

---

## Step 2: Process Node 2 ($k = 2$)

- Column 2: Nodes 1 and 3 can reach node 2
- Row 2: Node 2 can reach node 3 ($W[2][3] = 1$)

**New paths:**
- $1 \to 2 \to 3$: $W[1][3] = 1$ ✓
- $3 \to 2 \to 3$: $W[3][3] = 1$ ✓ (self-loop!)

$$
W_2 = \begin{pmatrix}
0 & 1 & \mathbf{1} \\
0 & 0 & 1 \\
1 & 1 & \mathbf{1}
\end{pmatrix}
$$

---

## Step 3: Process Node 3 ($k = 3$)

- Column 3: Nodes 1, 2, and 3 can reach node 3
- Row 3: Node 3 can reach nodes 1, 2, and itself

**New paths:**
- $1 \to 3 \to 1$: $W[1][1] = 1$ ✓
- $1 \to 3 \to 2$: $W[1][2]$ already 1
- $2 \to 3 \to 1$: $W[2][1] = 1$ ✓
- $2 \to 3 \to 2$: $W[2][2] = 1$ ✓

$$
W_3 = \begin{pmatrix}
\mathbf{1} & 1 & 1 \\
\mathbf{1} & \mathbf{1} & 1 \\
1 & 1 & 1
\end{pmatrix}
$$

**Wow!** The transitive closure is a **complete relation** — every node can reach every other node (including itself).

<MultipleChoice
  question="For a cycle $1 \to 2 \to 3 \to 1$, what is the transitive closure?"
  options={[
    "Just the original three edges",
    "All pairs except self-loops",
    "All 9 pairs (complete relation)",
    "Only the diagonal (reflexive closure)"
  ]}
  correct={2}
  explanation="In a cycle, you can eventually reach any node from any other node — including back to yourself. The transitive closure is the complete $3 \\times 3$ relation!"
/>

---

# Worked Example 3: A Larger Graph

Let's try a 4-node graph:

$$R = \{(1,2), (1,3), (2,4), (3,4)\}$$

**Diagram:** Two paths from 1 to 4:
- $1 \to 2 \to 4$
- $1 \to 3 \to 4$

$$
W_0 = \begin{pmatrix}
0 & 1 & 1 & 0 \\
0 & 0 & 0 & 1 \\
0 & 0 & 0 & 1 \\
0 & 0 & 0 & 0
\end{pmatrix}
$$

---

## Step 1: Process Node 1 ($k = 1$)

- Column 1: Nobody reaches node 1 (all zeros)
- No new paths created.

$$W_1 = W_0$$

---

## Step 2: Process Node 2 ($k = 2$)

- Column 2: Node 1 reaches node 2
- Row 2: Node 2 reaches node 4

**New path:** $1 \to 2 \to 4$, so $W[1][4] = 1$!

$$
W_2 = \begin{pmatrix}
0 & 1 & 1 & \mathbf{1} \\
0 & 0 & 0 & 1 \\
0 & 0 & 0 & 1 \\
0 & 0 & 0 & 0
\end{pmatrix}
$$

---

## Step 3: Process Node 3 ($k = 3$)

- Column 3: Node 1 reaches node 3
- Row 3: Node 3 reaches node 4

**Path check:** $1 \to 3 \to 4$ — but $W[1][4]$ is already 1 from step 2!

No new entries (the path was already found).

$$W_3 = W_2$$

---

## Step 4: Process Node 4 ($k = 4$)

- Column 4: Nodes 1, 2, 3 reach node 4
- Row 4: Node 4 reaches nobody (all zeros)

No new paths.

$$
W_4 = W_3 = \begin{pmatrix}
0 & 1 & 1 & 1 \\
0 & 0 & 0 & 1 \\
0 & 0 & 0 & 1 \\
0 & 0 & 0 & 0
\end{pmatrix}
$$

**Final transitive closure:** Added $(1,4)$ — node 1 can reach node 4 (via two possible routes).

<MultipleChoice
  question="In the graph with edges $(1,2), (1,3), (2,4), (3,4)$, how many new pairs were added to form the transitive closure?"
  options={[
    "0 — it was already transitive",
    "1 — just $(1,4)$",
    "2 — $(1,4)$ and $(2,3)$",
    "4 — many new pairs"
  ]}
  correct={1}
  explanation="Only $(1,4)$ was missing. Node 1 can reach 4 via $1 \\to 2 \\to 4$ or $1 \\to 3 \\to 4$. All other reachable pairs were already direct edges."
/>

---

# The Algorithm in Pseudocode

```
function Warshall(M: boolean[n][n]):
    W = copy of M
    
    for k = 1 to n:           // For each potential intermediate
        for i = 1 to n:       // For each source
            for j = 1 to n:   // For each destination
                W[i][j] = W[i][j] OR (W[i][k] AND W[k][j])
    
    return W
```

**Time Complexity:** Three nested loops, each running $n$ times → $O(n^3)$

**Space Complexity:** $O(n^2)$ for the matrix (can modify in-place)

<MultipleChoice
  question="How many times is the innermost comparison executed for an $n \\times n$ matrix?"
  options={[
    "$n$ times",
    "$n^2$ times",
    "$n^3$ times",
    "$2^n$ times"
  ]}
  correct={2}
  explanation="Three nested loops from 1 to $n$: outer loop runs $n$ times, middle $n$ times, inner $n$ times. Total: $n \\times n \\times n = n^3$."
/>

---

# Why Does In-Place Modification Work?

**Important insight:** We can modify $W$ in-place (without keeping $W_{k-1}$ separate) because:

1. The $k$-th row and column **don't change** at step $k$
2. When we compute $W[i][j]$, we only need $W[i][k]$ and $W[k][j]$
3. These values are from row $i$ column $k$ and row $k$ column $j$ — the $k$-th row/column!

Since the $k$-th row and column are stable during step $k$, reading "old" values from them is safe.

<MultipleChoice
  question="During step $k$, which entries of the matrix do NOT change?"
  options={[
    "The diagonal entries",
    "Row $k$ and column $k$",
    "All entries where $i < k$",
    "The entire upper triangle"
  ]}
  correct={1}
  explanation="Row $k$ and column $k$ remain unchanged because we only add paths *through* node $k$, not paths *ending or starting* at node $k$ that weren't already there."
/>

---

# Worked Example 4: Tracking Changes Carefully

Let's see another example with explicit change tracking:

$$
W_0 = \begin{pmatrix}
0 & 1 & 0 & 0 \\
0 & 0 & 1 & 0 \\
0 & 0 & 0 & 1 \\
1 & 0 & 0 & 0
\end{pmatrix}
$$

This is a 4-cycle: $1 \to 2 \to 3 \to 4 \to 1$

**Let's trace what happens:**

---

## $k = 1$: Route through node 1

- Who can reach 1? Node 4 ($W[4][1] = 1$)
- Who can 1 reach? Node 2 ($W[1][2] = 1$)

**New:** $(4, 2)$ via $4 \to 1 \to 2$

$$
W_1 = \begin{pmatrix}
0 & 1 & 0 & 0 \\
0 & 0 & 1 & 0 \\
0 & 0 & 0 & 1 \\
1 & \mathbf{1} & 0 & 0
\end{pmatrix}
$$

---

## $k = 2$: Route through node 2

- Who can reach 2? Nodes 1 and 4
- Who can 2 reach? Node 3

**New:** 
- $(1, 3)$ via $1 \to 2 \to 3$
- $(4, 3)$ via $4 \to 2 \to 3$

$$
W_2 = \begin{pmatrix}
0 & 1 & \mathbf{1} & 0 \\
0 & 0 & 1 & 0 \\
0 & 0 & 0 & 1 \\
1 & 1 & \mathbf{1} & 0
\end{pmatrix}
$$

---

## $k = 3$: Route through node 3

- Who can reach 3? Nodes 1, 2, and 4
- Who can 3 reach? Node 4

**New:**
- $(1, 4)$ via $1 \to 3 \to 4$
- $(2, 4)$ via $2 \to 3 \to 4$
- $(4, 4)$ via $4 \to 3 \to 4$ (self-loop!)

$$
W_3 = \begin{pmatrix}
0 & 1 & 1 & \mathbf{1} \\
0 & 0 & 1 & \mathbf{1} \\
0 & 0 & 0 & 1 \\
1 & 1 & 1 & \mathbf{1}
\end{pmatrix}
$$

---

## $k = 4$: Route through node 4

- Who can reach 4? All of them now!
- Who can 4 reach? Nodes 1, 2, 3, and 4

**New paths through 4:**
- From 1: $1 \to 4 \to \{1, 2, 3, 4\}$ → fills row 1
- From 2: $2 \to 4 \to \{1, 2, 3, 4\}$ → fills row 2
- From 3: $3 \to 4 \to \{1, 2, 3, 4\}$ → fills row 3

$$
W_4 = \begin{pmatrix}
\mathbf{1} & 1 & 1 & 1 \\
\mathbf{1} & \mathbf{1} & 1 & 1 \\
\mathbf{1} & \mathbf{1} & \mathbf{1} & 1 \\
1 & 1 & 1 & 1
\end{pmatrix}
$$

**Complete relation!** In a cycle, every node can reach every other node.

<MultipleChoice
  question="After processing all nodes in a 4-cycle, how many 1s are in the final matrix?"
  options={[
    "4 (only original edges)",
    "8 (original plus shortcuts)",
    "12 (all except diagonal)",
    "16 (complete relation)"
  ]}
  correct={3}
  explanation="A cycle allows reaching any node from any other node, including back to yourself. All 16 entries become 1."
/>

---

# Common Patterns and Shortcuts

## Pattern 1: Chains Create Shortcuts

For a chain $1 \to 2 \to 3 \to \cdots \to n$:
- Transitive closure adds all $(i, j)$ where $i < j$
- Result: upper triangular matrix of 1s (above diagonal)

## Pattern 2: Cycles Fill Everything

For a cycle $1 \to 2 \to \cdots \to n \to 1$:
- Eventually everyone can reach everyone
- Transitive closure is the **complete relation** (all 1s)

## Pattern 3: Disconnected Components Stay Disconnected

If there's no path between nodes $a$ and $b$ (in either direction):
- Warshall's algorithm won't create one
- The transitive closure respects connectivity

<MultipleChoice
  question="For a directed chain $1 \to 2 \to 3 \to 4$, how many pairs are in the transitive closure?"
  options={[
    "3 (the original edges)",
    "6 (all $i < j$ pairs)",
    "10 (including diagonal)",
    "16 (complete relation)"
  ]}
  correct={1}
  explanation="In a chain, you can reach any later node from an earlier one. Pairs: $(1,2), (1,3), (1,4), (2,3), (2,4), (3,4)$ = 6 pairs. This is $\\binom{4}{2} = 6$."
/>

---

# Exam Strategy: Step-by-Step Verification

When solving Warshall problems on exams:

1. **Write the initial matrix $W_0$ clearly**
2. **Process nodes in order 1, 2, 3, ...**
3. **At each step, check:** "Who reaches $k$? Who does $k$ reach?"
4. **Only update cells** where both conditions are true
5. **Circle or highlight** changed entries

**Pro tip:** The $k$-th row and column never change at step $k$. Use this to quickly identify potential changes — they're always at the **intersection** of "reaches $k$" rows and "$k$ reaches" columns.

---

# Practice: Identify Entry Changes

<AdaptiveQuiz
  generator="warshall-entry-change"
  baseSeed={77777}
  initialCount={5}
  appendCount={2}
  maxQuestions={15}
/>

---

# Practice: Matrix After Step $k$

<AdaptiveQuiz
  generator="warshall-matrix-step"
  baseSeed={88888}
  initialCount={5}
  appendCount={2}
  maxQuestions={15}
/>

---

# Practice: Conceptual Understanding

<AdaptiveQuiz
  generator="warshall-concept"
  baseSeed={99999}
  initialCount={5}
  appendCount={2}
  maxQuestions={15}
/>

---

# Quick Reference Card

| Aspect | Details |
|--------|---------|
| **Purpose** | Compute transitive closure (reachability) |
| **Input** | $n \times n$ boolean adjacency matrix |
| **Output** | Transitive closure matrix |
| **Formula** | $W_k[i][j] = W_{k-1}[i][j] \lor (W_{k-1}[i][k] \land W_{k-1}[k][j])$ |
| **Time** | $O(n^3)$ |
| **Space** | $O(n^2)$ — or $O(1)$ extra if in-place |

**The Mantra:**
> "At step $k$: Can I reach $j$ from $i$ by going through node $k$?"

$$\boxed{W[i][j] = W[i][j] \lor (W[i][k] \land W[k][j])}$$

<MultipleChoice
  question="Which closure does Warshall's algorithm compute?"
  options={[
    "Reflexive closure",
    "Symmetric closure",
    "Transitive closure",
    "Reflexive-transitive closure"
  ]}
  correct={2}
  explanation="Warshall's algorithm computes the transitive closure — all pairs $(a,b)$ where $b$ is reachable from $a$ via any path. It does NOT add the diagonal (reflexive) automatically."
/>

---

# Bonus: Why Not Just Square the Matrix?

You might wonder: "Can't I just compute $M \cup M^2 \cup M^3 \cup \cdots$?"

**Yes, but:**
- You need up to $n-1$ matrix multiplications
- Each multiplication is $O(n^3)$
- Total: $O(n^4)$ — slower than Warshall!

Warshall's algorithm is cleverer: it builds reachability **incrementally** in a single $O(n^3)$ pass.

<MultipleChoice
  question="Computing transitive closure via repeated matrix squaring takes:"
  options={[
    "$O(n^2)$",
    "$O(n^3)$",
    "$O(n^4)$ or worse",
    "$O(\\log n)$"
  ]}
  correct={2}
  explanation="Naive approach needs up to $n-1$ matrix products at $O(n^3)$ each = $O(n^4)$. With repeated squaring optimization: $O(n^3 \\log n)$. Warshall wins with just $O(n^3)$!"
/>

---

# Master Challenge: Full Traces

Can you trace Warshall's algorithm from start to finish? Try these on paper, then verify with the quizzes:

**Challenge 1:**
$$W_0 = \begin{pmatrix} 0 & 1 \\ 1 & 0 \end{pmatrix}$$

**Challenge 2:**
$$W_0 = \begin{pmatrix} 0 & 1 & 0 \\ 0 & 0 & 0 \\ 1 & 0 & 0 \end{pmatrix}$$

**Challenge 3:**
$$W_0 = \begin{pmatrix} 0 & 0 & 1 \\ 1 & 0 & 0 \\ 0 & 1 & 0 \end{pmatrix}$$

Work through each step, then check your answer!

<MultipleChoice
  question="For the 2×2 matrix with $(1,2)$ and $(2,1)$ (a 2-cycle), what is the transitive closure?"
  options={[
    "Unchanged — still just the two original edges",
    "All four entries become 1 (complete relation)",
    "Only the diagonal becomes 1",
    "The matrix becomes all zeros"
  ]}
  correct={1}
  explanation="A 2-cycle: $1 \\to 2 \\to 1$ and $2 \\to 1 \\to 2$. Everyone reaches everyone, including themselves! All four entries become 1."
/>

---

**You've mastered Warshall's Algorithm!**

The key insight: build reachability one intermediate node at a time. Each step asks a simple question, and the algorithm's elegance lies in how these simple steps combine to solve a complex problem efficiently.
